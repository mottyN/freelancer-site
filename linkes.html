<!doctype html>
<html lang="he" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>××“××” ×™×¦×™×¨×ª ×§×™×©×•×¨×™× ××§×•×¦×¨×™× + ××¢×§×‘ ×œ×—×™×¦×•×ª</title>
  <style>
    :root{
      --bg:#0f172a; /* slate-900 */
      --card:#111827; /* gray-900 */
      --muted:#94a3b8; /* slate-400 */
      --text:#e5e7eb; /* gray-200 */
      --brand:#22c55e; /* green-500 */
      --brand-2:#16a34a; /* green-600 */
      --danger:#ef4444; /* red-500 */
      --shadow:0 10px 25px rgba(0,0,0,.4);
    }
    *{box-sizing:border-box}
    body{margin:0;background:linear-gradient(180deg,#0b1220,#0f172a);color:var(--text);font-family:Inter,Arial,Helvetica,sans-serif;min-height:100dvh}
    a{color:#7dd3fc}
    .container{max-width:1000px;margin-inline:auto;padding:32px}
    .hero{display:flex;flex-direction:column;gap:16px;align-items:center;text-align:center;margin-top:24px;margin-bottom:28px}
    .title{font-size:clamp(28px,4vw,40px);font-weight:800;letter-spacing:.3px}
    .subtitle{color:var(--muted)}
    .card{background:linear-gradient(180deg,#0b1220,#0b1220 60%,#0f172a);border:1px solid #1f2937;border-radius:20px;box-shadow:var(--shadow)}
    .main-card{padding:28px;display:flex;flex-direction:column;gap:22px}
    .primary-btn{appearance:none;border:none;background:linear-gradient(135deg,var(--brand),var(--brand-2));color:white;padding:18px 26px;border-radius:16px;font-weight:800;font-size:20px;cursor:pointer;transform:translateY(0);transition:transform .05s ease,filter .2s ease;box-shadow:0 8px 24px rgba(34,197,94,.3)}
    .primary-btn:active{transform:translateY(1px)}
    .list{display:grid;gap:12px}
    .row{display:grid;grid-template-columns:1fr auto;gap:12px;align-items:center;background:#0b1220;border:1px solid #1f2937;padding:16px;border-radius:14px}
    .row-title{font-weight:700}
    .row-sub{font-size:13px;color:var(--muted);overflow:hidden;text-overflow:ellipsis;white-space:nowrap}
    .row-actions{display:flex;gap:10px}
    .btn{appearance:none;border:1px solid #1f2937;background:#0b1320;color:var(--text);padding:10px 14px;border-radius:12px;cursor:pointer}
    .btn:hover{filter:brightness(1.1)}
    .badge{display:inline-flex;align-items:center;gap:6px;background:#111827;border:1px solid #1f2937;color:#d1fae5;padding:6px 10px;border-radius:999px;font-size:12px}
    .empty{opacity:.8;color:var(--muted);text-align:center;padding:26px}
    .grid-head{display:flex;justify-content:space-between;align-items:center}
    .search{display:flex;gap:10px}
    .input{width:320px;max-width:60vw;background:#0b1220;border:1px solid #1f2937;color:var(--text);padding:12px 14px;border-radius:12px}
    .copy{font-size:12px}

    /* Modal */
    .modal-backdrop{position:fixed;inset:0;background:rgba(0,0,0,.6);display:none;align-items:center;justify-content:center;z-index:50}
    .modal{width:min(560px,92vw);background:#0b1220;border:1px solid #1f2937;border-radius:18px;box-shadow:var(--shadow);padding:22px}
    .modal h3{margin:0 0 14px 0}
    .modal .field{display:flex;flex-direction:column;gap:8px;margin:10px 0}
    .modal input{background:#0b1220;border:1px solid #1f2937;color:var(--text);padding:12px 14px;border-radius:12px}
    .modal .actions{display:flex;gap:10px;justify-content:flex-start;margin-top:14px}

    /* Detail page */
    .detail{max-width:760px;margin-inline:auto}
    .mono{font-family:ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace}
    .muted{color:var(--muted)}
    .table{width:100%;border-collapse:collapse;margin-top:12px}
    .table th,.table td{border-bottom:1px solid #1f2937;padding:10px 6px;text-align:start}
    .danger{color:#fecaca}
    .link-box{background:#0b1220;border:1px dashed #334155;border-radius:12px;padding:12px}
  </style>
</head>
<body>
  <div id="app"></div>

  <!-- Modal for new link -->
  <div id="newLinkModal" class="modal-backdrop" role="dialog" aria-modal="true" aria-labelledby="newLinkTitle">
    <div class="modal">
      <h3 id="newLinkTitle">×¦×•×¨ ×§×™×©×•×¨ ×—×“×©</h3>
      <p class="muted">××œ× ××ª ×”×¤×¨×˜×™× ×•×œ××—×¨ ××›×Ÿ ×œ×—×¥ ×¢×œ <b>"×¦×•×¨ ×œ×™ ×§×™×©×•×¨"</b>.</p>
      <div class="field">
        <label>×©× ×œ×§×™×©×•×¨</label>
        <input id="fieldName" type="text" placeholder="×œ×“×•×’××”: ×˜×•×¤×¡ ×”×¨×©××”" />
      </div>
      <div class="field">
        <label>×›×ª×•×‘×ª ×™×¢×“ (URL)</label>
        <input id="fieldUrl" type="url" placeholder="https://example.com" />
      </div>
      <div class="actions">
        <button class="primary-btn" id="btnCreate">×¦×•×¨ ×œ×™ ×§×™×©×•×¨</button>
        <button class="btn" id="btnClose">×‘×˜×œ</button>
      </div>
    </div>
  </div>

  <script>
  // ===== × ×ª×•× ×™ ×”××¤×œ×™×§×¦×™×” (LocalStorage) =====
  const DB_KEY = 'link_shortener_db_v1';
  function loadDB(){
    try{ return JSON.parse(localStorage.getItem(DB_KEY)) || {links:{}}; }catch{ return {links:{}} }
  }
  function saveDB(db){ localStorage.setItem(DB_KEY, JSON.stringify(db)); }

  function uid(){ return Math.random().toString(36).slice(2,9); }

  function shortUrlFor(id){
    const base = location.origin + location.pathname;
    return `${base}#/l/${id}`;
  }

  // ===== Router (hash-based) =====
  function route(){
    const hash = location.hash || '#/';
    const [_, path, id] = hash.split('/');
    if(path === '') return renderHome();
    if(path === 'l' && id) return handleRedirect(id);
    if(path === 'details' && id) return renderDetails(id);
    // default
    return renderHome();
  }

  // ===== Views =====
  function renderHome(){
    const db = loadDB();
    const links = Object.values(db.links).sort((a,b)=> b.createdAt - a.createdAt);
    const el = document.getElementById('app');
    el.innerHTML = `
      <div class="container">
        <div class="hero">
          <div class="title">××“××” ×™×¦×™×¨×ª ×§×™×©×•×¨×™ ×§×™×¦×•×¨ ×•××¢×§×‘ ×œ×—×™×¦×•×ª</div>
          <div class="subtitle">×œ×—×¥ ×¢×œ ×”×›×¤×ª×•×¨ ×›×“×™ ×œ×™×¦×•×¨ ×§×™×©×•×¨ ×—×“×©. ××ª×—×ª×™×• ×ª×•×¤×™×¢ ×¨×©×™××ª ×›×œ ×”×§×™×©×•×¨×™×.</div>
          <button class="primary-btn" id="openModal">×¦×•×¨ ×§×™×©×•×¨</button>
        </div>
        <div class="card main-card">
          <div class="grid-head">
            <div>
              <strong>×›×œ ×”×§×™×©×•×¨×™×</strong>
              <span class="muted">(${links.length})</span>
            </div>
            <div class="search">
              <input id="searchInput" class="input" placeholder="×—×™×¤×•×© ×œ×¤×™ ×©× ××• ×›×ª×•×‘×ª..." />
              <button class="btn" id="refreshBtn">×¨×¢× ×Ÿ</button>
            </div>
          </div>
          <div id="list" class="list">${links.length? links.map(rowTpl).join(''): `<div class='empty'>××™×Ÿ ×¢×“×™×™×Ÿ ×§×™×©×•×¨×™×. ×œ×—×¥ ×¢×œ "×¦×•×¨ ×§×™×©×•×¨" ×›×“×™ ×œ×”×ª×—×™×œ.</div>`}</div>
        </div>
      </div>`;

    // events
    document.getElementById('openModal').onclick = openModal;
    document.getElementById('refreshBtn').onclick = ()=>renderHome();
    document.getElementById('searchInput').oninput = (e)=> filterList(e.target.value);

    function filterList(q){
      q = (q||'').toLowerCase();
      const container = document.getElementById('list');
      if(!q){ container.querySelectorAll('.row').forEach(r=> r.style.display='grid'); return; }
      container.querySelectorAll('.row').forEach(r=>{
        const txt = (r.dataset.search||'').toLowerCase();
        r.style.display = txt.includes(q)? 'grid':'none';
      });
    }

    function rowTpl(link){
      const su = shortUrlFor(link.id);
      const search = `${link.name} ${link.url} ${su}`;
      return `
        <div class="row" data-search="${escapeHtml(search)}">
          <div>
            <div class="row-title">${escapeHtml(link.name)}</div>
            <div class="row-sub mono">${escapeHtml(su)}</div>
          </div>
          <div class="row-actions">
            <span class="badge" title="××¡×¤×¨ ×œ×—×™×¦×•×ª">${link.clicks?.length||0} ×œ×—×™×¦×•×ª</span>
            <button class="btn copy" data-id="${link.id}" data-url="${su}">×”×¢×ª×§ ×§×™×¦×•×¨</button>
            <button class="btn" onclick="window.open('#/details/${link.id}','_blank')">×¤×ª×— ×“×£ ×¤×¨×˜×™×</button>
            <button class="btn" onclick="deleteLink('${link.id}')" title="××—×§">ğŸ—‘ï¸</button>
          </div>
        </div>`;
    }

    // copy buttons
    el.querySelectorAll('.copy').forEach(btn=>{
      btn.addEventListener('click', async ()=>{
        try{ await navigator.clipboard.writeText(btn.dataset.url); toast('×”×§×™×¦×•×¨ ×”×•×¢×ª×§'); }catch{ toast('×œ× ×”×¦×œ×—×ª×™ ×œ×”×¢×ª×™×§'); }
      });
    });
  }

  function renderDetails(id){
    const db = loadDB();
    const link = db.links[id];
    const el = document.getElementById('app');
    if(!link){
      el.innerHTML = `<div class='container detail'><h2>×œ× × ××¦×</h2><p class='muted'>×”×§×™×©×•×¨ ×”××‘×•×§×© ××™× ×• ×§×™×™×.</p><p><a href="#/">×—×–×¨×” ×œ×“×£ ×”×¨××©×™</a></p></div>`;
      return;
    }
    const su = shortUrlFor(link.id);
    el.innerHTML = `
      <div class="container detail">
        <div class="card" style="padding:24px">
          <h1 style="margin-top:0">×¤×¨×˜×™ ×§×™×©×•×¨</h1>
          <div class="link-box">
            <div><b>×©×:</b> ${escapeHtml(link.name)}</div>
            <div class="mono"><b>×§×™×¦×•×¨:</b> <a href="${su}" target="_blank" rel="noopener">${escapeHtml(su)}</a></div>
            <div class="mono"><b>×™×¢×“:</b> <a href="${escapeHtml(link.url)}" target="_blank" rel="noopener">${escapeHtml(link.url)}</a></div>
            <div class="muted"><b>× ×•×¦×¨:</b> ${new Intl.DateTimeFormat('he-IL',{dateStyle:'medium', timeStyle:'short'}).format(new Date(link.createdAt))}</div>
          </div>
          <div style="margin-top:14px">
            <span class="badge">×¡×”"×› ×œ×—×™×¦×•×ª: ${link.clicks?.length||0}</span>
          </div>
          <h3 style="margin:18px 0 8px">×”×™×¡×˜×•×¨×™×™×ª ×œ×—×™×¦×•×ª</h3>
          ${link.clicks?.length? clicksTable(link.clicks): `<div class='muted'>××™×Ÿ ×¢×“×™×™×Ÿ ×œ×—×™×¦×•×ª.</div>`}
          <div style="margin-top:18px">
            <button class="btn" onclick="window.location.hash='#/'">×—×–×¨×” ×œ×¨×©×™××”</button>
          </div>
        </div>
      </div>`;

    function clicksTable(arr){
      const rows = arr.slice().reverse().map((t,i)=>{
        const d = new Date(t);
        return `<tr><td>${i+1}</td><td>${new Intl.DateTimeFormat('he-IL',{dateStyle:'medium', timeStyle:'short'}).format(d)}</td></tr>`
      }).join('');
      return `<table class="table"><thead><tr><th>#</th><th>×–××Ÿ ×œ×—×™×¦×”</th></tr></thead><tbody>${rows}</tbody></table>`;
    }
  }

  async function handleRedirect(id){
    const db = loadDB();
    const link = db.links[id];
    const el = document.getElementById('app');
    if(!link){
      el.innerHTML = `<div class='container'><div class='card' style='padding:24px'><h2>×§×™×©×•×¨ ××§×•×¦×¨ ×œ× × ××¦×</h2><p class='muted'>×™×™×ª×›×Ÿ ×©×”×§×™×©×•×¨ × ××—×§.</p><p><a href="#/">×œ×“×£ ×”×¨××©×™</a></p></div></div>`;
      return;
    }
    // ×¢×“×›×•×Ÿ ××™×™×“×™ ×©×œ ×”×œ×—×™×¦×”
    link.clicks = link.clicks || [];
    link.clicks.push(Date.now());
    saveDB(db);

    el.innerHTML = `<div class='container'><div class='card' style='padding:24px'><h2>××¢×‘×™×¨ ×œ×™×¢×“â€¦</h2><p class='muted mono'>${escapeHtml(link.url)}</p><p class='muted'>×× ×œ× ×”×•×¢×‘×¨×ª ××•×˜×•××˜×™×ª, <a href='${escapeHtml(link.url)}'>×œ×—×¥ ×›××Ÿ</a>.</p></div></div>`;

    // ×”×©×”×™×” ×§×˜× ×” ×›×“×™ ×©×”××¡×š ×™×™×¨××” ×œ×¤× ×™ ×”× ×™×•×•×˜
    setTimeout(()=>{ location.replace(link.url); }, 350);
  }

  // ===== ×™×¦×™×¨×”/××—×™×§×” =====
  function openModal(){
    const bd = document.getElementById('newLinkModal');
    const name = document.getElementById('fieldName');
    const url = document.getElementById('fieldUrl');
    bd.style.display='flex';
    name.value=''; url.value='';
    setTimeout(()=> name.focus(), 50);
  }
  function closeModal(){ document.getElementById('newLinkModal').style.display='none'; }

  function deleteLink(id){
    if(!confirm('×œ××—×•×§ ××ª ×”×§×™×©×•×¨?')) return;
    const db = loadDB();
    delete db.links[id];
    saveDB(db);
    toast('× ××—×§');
    renderHome();
  }

  function createLink(){
    const name = document.getElementById('fieldName').value.trim();
    const url  = document.getElementById('fieldUrl').value.trim();
    if(!name) return toast('× × ×œ××œ× ×©× ×œ×§×™×©×•×¨');
    if(!/^https?:\/\//i.test(url)) return toast('× × ×œ×”×–×™×Ÿ ×›×ª×•×‘×ª ×™×¢×“ ×—×•×§×™×ª ×”××ª×—×™×œ×” ×‘- http:// ××• https://');
    const db = loadDB();
    const id = uid();
    db.links[id] = { id, name, url, createdAt: Date.now(), clicks: [] };
    saveDB(db);
    closeModal();
    renderHome();
    toast('×§×™×©×•×¨ × ×•×¦×¨ ×•×”×ª×•×•×¡×£ ×œ×¨×©×™××”');
  }

  // ===== ×¢×–×¨ =====
  function escapeHtml(str){
    return String(str).replace(/[&<>\"']/g, s=>({"&":"&amp;","<":"&lt;",">":"&gt;","\"":"&quot;","'":"&#39;"}[s]));
  }

  function toast(msg){
    const t = document.createElement('div');
    t.textContent = msg;
    t.style.cssText = 'position:fixed;inset-inline:0;top:14px;margin:auto;background:#0b1220;border:1px solid #1f2937;color:#e5e7eb;padding:10px 16px;border-radius:999px;width:max-content;box-shadow:var(--shadow);z-index:99';
    document.body.appendChild(t);
    setTimeout(()=> t.remove(), 1800);
  }

  // ===== ××™×¨×•×¢×™ ××•×“×œ =====
  document.getElementById('btnCreate').onclick = createLink;
  document.getElementById('btnClose').onclick = closeModal;
  document.getElementById('newLinkModal').addEventListener('click', (e)=>{
    if(e.target.id==='newLinkModal') closeModal();
  });

  // ===== ×”×¤×¢×œ×” =====
  window.addEventListener('hashchange', route);
  route();
  </script>
</body>
</html>
